<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta
      name="author"
      content="Mark Otto, Jacob Thornton, and Bootstrap contributors"
    />
    <meta name="generator" content="Hugo 0.88.1" />
    <title>EZ訂火車</title>

    <link
      rel="canonical"
      href="https://getbootstrap.com/docs/5.1/examples/checkout/"
    />

    <!-- Bootstrap core CSS -->
    <link href="./assetsB/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      .form-check-input:checked {
        background-color: #0e9c26 !important;
        border-color: #0e9c26 !important;
      }
    </style>
    <script
      src="statics/js/jquery-3.4.1.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-2.1.4.min.js"
    ></script>
    <!-- Custom styles for this template -->
    <link href="./assetsB/dist/css/form-validation.css" rel="stylesheet" />
  </head>
  <body class="bg-light">
    <div class="container">
      <main>
        <div class="py-5 text-center"></div>

        <div class="row g-5">
          <div class="col-md-5 col-lg-4 order-md-last">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
              <span class="text-success">車票總計</span>
              <span
                class="badge bg-success rounded-pill"
                id="ticketCount"
              ></span>
            </h4>
            <ul class="list-group mb-3" id="tickets">
              <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                  <h6 class="my-0">車票一</h6>
                  <small class="text-muted">時程</small>
                </div>
                <span class="text-muted">$12</span>
              </li>
              <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                  <h6 class="my-0">車票二</h6>
                  <small class="text-muted">時程</small>
                </div>
                <span class="text-muted">$8</span>
              </li>
              <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                  <h6 class="my-0">車票三</h6>
                  <small class="text-muted">時程</small>
                </div>
                <span class="text-muted">$5</span>
              </li>
              <li class="list-group-item d-flex justify-content-between">
                <span>Total (NT)</span>
                <strong>$25</strong>
              </li>
            </ul>
          </div>
          <div class="col-md-7 col-lg-8">
            <h4 class="mb-3">付款頁面</h4>
            <form class="needs-validation" novalidate>
              <hr class="my-4" />

              <h4 class="mb-3">付款</h4>

              <div class="my-3">
                <div class="form-check">
                  <input
                    id="credit"
                    name="paymentMethod"
                    type="radio"
                    class="form-check-input"
                    checked
                    required
                  />
                  <label class="form-check-label" for="credit">信用卡</label>
                </div>
                <div class="form-check">
                  <input
                    id="debit"
                    name="paymentMethod"
                    type="radio"
                    class="form-check-input"
                    required
                  />
                  <label class="form-check-label" for="debit">簽帳金融卡</label>
                </div>
                <div class="form-check">
                  <input
                    id="paypal"
                    name="paymentMethod"
                    type="radio"
                    class="form-check-input"
                    required
                  />
                  <label class="form-check-label" for="paypal">PayPal</label>
                </div>
              </div>

              <div class="row gy-3">
                <div class="col-md-6">
                  <label for="cc-name" class="form-label">使用此卡的姓名</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cc-name"
                    placeholder=""
                    required
                  />
                  <small class="text-muted"
                    >Full name as displayed on card</small
                  >
                  <div class="invalid-feedback">必須填寫使用此卡的姓名</div>
                </div>

                <div class="col-md-6">
                  <label for="cc-number" class="form-label">信用卡卡號</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cc-number"
                    placeholder=""
                    required
                  />
                  <div class="invalid-feedback">必須填寫信用卡卡號</div>
                </div>

                <div class="col-md-3">
                  <label for="cc-expiration" class="form-label"
                    >信用卡到期日</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="cc-expiration"
                    placeholder=""
                    required
                  />
                  <div class="invalid-feedback">必須填寫性用卡到期日</div>
                </div>

                <div class="col-md-3">
                  <label for="cc-cvv" class="form-label">CVV</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cc-cvv"
                    placeholder=""
                    required
                  />
                  <div class="invalid-feedback">必須填寫信用卡安全代碼</div>
                </div>
              </div>

              <hr class="my-4" />
              <input
                type="button"
                value="結帳"
                class="w-100 btn btn-success btn-lg"
                id="submit"
              />
            </form>
          </div>
        </div>
      </main>

      <!-- <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2017–2021 Company Name</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="#">Privacy</a></li>
          <li class="list-inline-item"><a href="#">Terms</a></li>
          <li class="list-inline-item"><a href="#">Support</a></li>
        </ul>
      </footer> -->
    </div>

    <script type="text/javascript">
      let TrainTypeName = new URL(location.href).searchParams.get(
        "TrainTypeName"
      );
      console.log("TrainTypeName", TrainTypeName);
      let TrainNo = new URL(location.href).searchParams.get("TrainNo");
      console.log("TrainNo", TrainNo);
      let startingStation = new URL(location.href).searchParams.get(
        "startingStation"
      );
      console.log("startingStation", startingStation);
      let endingStationName = new URL(location.href).searchParams.get(
        "endingStationName"
      );
      console.log("endingStationName", endingStationName);
      let originStopTime = new URL(location.href).searchParams.get(
        "originStopTime"
      );
      console.log("originStopTime", originStopTime);
      let destinationStopTime = new URL(location.href).searchParams.get(
        "destinationStopTime"
      );
      console.log("destinationStopTime", destinationStopTime);
      let fares = new URL(location.href).searchParams.get("fares");
      console.log("fares", fares);
      let date = new URL(location.href).searchParams.get("date");
      console.log("date", date);
      let departureStation = new URL(location.href).searchParams.get(
        "departureStation"
      );
      console.log("departureStation", departureStation);
      let arrivalStation = new URL(location.href).searchParams.get(
        "arrivalStation"
      );
      console.log("arrivalStation", arrivalStation);
      let ticketAmount = new URL(location.href).searchParams.get(
        "ticketAmount"
      );
      console.log("ticketAmount", ticketAmount);

      let ticketInfo = [
        {
          TrainTypeName: TrainTypeName,
          TrainNo: TrainNo,
          startingStation: startingStation,
          endingStationName: endingStationName,
          originStopTime: originStopTime,
          destinationStopTime: destinationStopTime,
          fares: fares,
          date: date,
          departureStation: departureStation,
          arrivalStation: arrivalStation,

          ticketAmount: ticketAmount,
        },
      ];
      for (let i = 0; i < parseInt(ticketAmount) - 1; i++) {
        ticketInfo = ticketInfo.concat(ticketInfo[0]);
      }
      console.log("ticketInfo", ticketInfo);

      document.getElementById("tickets").innerHTML = `
        ${ticketInfo.map(
          (data) => `
                <li class="list-group-item d-flex justify-content-between lh-sm">
                    <div>
                      <h6 class="my-0">車票</h6>
                      <small class="text-muted">時程</small></br>
                      <small>日期 : ${data.date}</small></br>
                      <small>${data.TrainTypeName} ${data.TrainNo}</small></br>
                      <small>${data.departureStation}→${data.arrivalStation}</small></br>
                      <small>出發時間:${data.originStopTime}→ 抵達時間:${data.destinationStopTime}</small>
                    </div>
                    <span class="text-muted">$${data.fares}</span>
                </li>
                `
        )}
        `;
      document.getElementById("ticketCount").innerHTML = `${ticketAmount}`;
      // var [client_cart_obj, client_cart_amount] = getCartDataFromClient();

      // if (client_cart_obj.length == 0) {
      //   alert("購物車沒有任何商品！");
      //   calcSummaryInformation();
      //   setButtonState("check", false);
      // } else getCartProduct();

      $(document).ready(function () {
        // 處理表單點擊事件
        var $form = $("#submit");
        $form.click(function () {
          submit();
        });

        function submit() {
          var url_string = window.location.href;
          var url = new URL(url_string);
          var member_id = url.searchParams.get("id");
          var trainNo = TrainNo;
          var dStation = departureStation;
          var aStation = arrivalStation;
          var sStation = startingStation;
          var eStation = endingStationName;
          var dTime = originStopTime + ":00";
          var aTime = destinationStopTime + ":00";
          var amount = ticketAmount;
          var price = fares;
          var totalprice = amount * fares;
          var tdate = date;
          var type = TrainTypeName;


          var data_object = {
            mId: member_id,
            trainNO: trainNo,
            departureStation: dStation,
            arrivalStation: aStation,
            startingStation: sStation,
            endingStation: eStation,
            departureTime: dTime,
            arrivalTime: aTime,
            amount: amount,
            price: totalprice,
            date: tdate,
            trainType: type,
          };

          // 將JSON格式轉換成字串
          var data_string = JSON.stringify(data_object);

          // 發出POST的AJAX請求
          $.ajax({
            type: "POST",
            url: "api/book.do",
            data: data_string,
            crossDomain: true,
            cache: false,
            dataType: "json",
            timeout: 5000,
            success: function (response) {
              $("#flashMessage").html(response.message);
              $("#flashMessage").show();
              if (response.status == 200) {
                //updateSQLTable(response.response);
                alert("成功");
              }
            },
            error: function () {
              alert("無法連線到伺服器！");
            },
          });
        }
      });
    </script>

    <script src="./assetsB/dist/js/bootstrap.bundle.min.js"></script>

    <script src="./assetsB/dist/js/form-validation.js"></script>
  </body>
</html>

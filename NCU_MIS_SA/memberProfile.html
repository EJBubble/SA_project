<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>EZ訂火車</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="assetsA/img/favicon.png" rel="icon" />
    <link href="assetsA/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="assetsA/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="assetsA/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="assetsA/vendor/boxicons/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link href="assetsA/vendor/quill/quill.snow.css" rel="stylesheet" />
    <link href="assetsA/vendor/quill/quill.bubble.css" rel="stylesheet" />
    <link href="assetsA/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assetsA/vendor/simple-datatables/style.css" rel="stylesheet" />

    <!-- Template Main CSS File -->
    <link href="assetsA/css/style.css" rel="stylesheet" />
    <link href="assets/css/styleA.css" rel="stylesheet" />

    <script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>

    <style>

      .nav-tabs-bordered .nav-link.active {
        color:  #0E9C26 !important;
        border-bottom: 2px solid #0E9C26 !important;
      }
      .nav-link:hover{
        color:  #0E9C26 !important;
      }
    </style>

  </head>

  <body>
    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top">
      <div class="container d-flex align-items-center">

        <h1 class="logo me-auto"><a href="indexA.html"><span>EZ</span>訂火車</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html" class="logo me-auto me-lg-0"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->

        <nav id="navbar" class="navbar order-last order-lg-0">
          <ul>
            <li><a href="indexA.html" class="active">Home</a></li>

            <li><a href="railway.html" id="link1">關於台鐵</a></li>
            <li><a href="travel.html" id="link2">旅遊票券</a></li>
            <li><a href="railwaypolice.html" id="link3">鐵路警察局</a></li>
            <li><a href="contact.html" id="link4">聯絡客服</a></li>
            <li><a href="train.html" id="link5">列車查詢</a></li>
            <li><a href="booking.html" id="link6">訂票</a></li>
            <li><a href="pagesLogin.html" id="link7">登入</a></li>
            <li><a href="pagesRegister.html" id="link8">註冊</a></li>
            <li><a href="trainOrderDetail.html" id="link9"></a></li>

          </ul>
          <i class="bi bi-list mobile-nav-toggle"></i>
        </nav><!-- .navbar -->

        <div class="header-social-links d-flex">
          <a href="#" class="twitter"><i class="bu bi-twitter"></i></a>
          <a href="#" class="facebook"><i class="bu bi-facebook"></i></a>
          <a href="#" class="instagram"><i class="bu bi-instagram"></i></a>
          <a href="#" class="linkedin"><i class="bu bi-linkedin"></i></i></a>
        </div>

      </div>
    </header><!-- End Header -->

    
    <main>
      <div class="container">
        <section>
          
                <div class="d-flex justify-content-center py-4">
                  <a
                    href="index.html"
                    class="logo d-flex align-items-center w-auto"
                  >

                  </a>
                </div>
                <!-- End Logo -->

                
                <div class="card mb-3">
                  <div class="card-body">
                    

                    
                      <div class="card-body pt-3">
                        <!-- Bordered Tabs -->
                        <ul class="nav nav-tabs nav-tabs-bordered">
          
                          <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-overview">會員資料</button>
                          </li>
          
                          <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-change-name">更改會員名稱</button>
                          </li>

                          <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-change-E-mail">更改會員電話</button>
                          </li>

                          <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-change-password">更改會員密碼</button>
                          </li>
          
                        </ul>

                        <div class="tab-content pt-2">
          
                          <div class="tab-pane fade show active profile-overview" id="profile-overview">       
          
                            <h5 class="card-title">會員資料</h5>
          
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label ">電子郵件</div>
                              <input name="email" type="email" class="form-control" id="newemail" required="required" disabled/>
                            </div>
          
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">會員名稱</div>
                              <div class="col-lg-9 col-md-8 " id="disable_name"></div>
                            </div>
          
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">電話</div>
                              <div class="col-lg-9 col-md-8" id="disable_phone"></div>
                            </div>
          
              
          
                          </div>  

                          <div class="tab-pane fade pt-3" id="profile-change-password">
                            <!-- Change Password Form -->
                            <form>
          
                              <div class="row mb-3">
                                <label for="currentPassword" class="col-md-4 col-lg-3 col-form-label">原密碼</label>
                                <div class="col-md-8 col-lg-9">
                                  <input name="password" type="password" class="form-control" id="currentPassword" required/>
                                </div>
                              </div>
          
                              <div class="row mb-3">
                                <label for="newPassword" class="col-md-4 col-lg-3 col-form-label">新密碼</label>
                                <div class="col-md-8 col-lg-9">
                                  <input name="newpassword" type="password" class="form-control" id="newPassword" required/>
                                </div>
                              </div>
          
                              <div class="row mb-3">
                                <label for="renewPassword" class="col-md-4 col-lg-3 col-form-label">再次輸入新密碼</label>
                                <div class="col-md-8 col-lg-9">
                                  <input name="renewpassword" type="password" class="form-control" id="renewPassword" required>
                                </div>
                              </div>
          
                              <div class="text-center">
                                <input type="button" value="更新" class="btn btn-success" id="submitpassword">
                              </div>
                            </form><!-- End Change Password Form -->          
                          </div>

                                                        
          
                          <div class="tab-pane fade pt-3" id="profile-change-E-mail" >
                            <!-- change-E-mail Form -->
                            <form>
          
                              <div class="row mb-3">
                                <label for="newphone" class="col-md-4 col-lg-3 col-form-label">新電話</label>
                                <div class="col-md-8 col-lg-9">
                                  <input name="phone" type="phone" class="form-control" id="newphone" required/>
                                  <div class="invalid-feedback">
                                    請輸入你的新電話!
                                   </div>
                                </div>
                              </div>
                             
                              <div class="text-center">
                                <input type="button" value="更新" class="btn btn-success" id="submitphone">
                              </div>
                            </form><!-- End change-E-mail Form -->
          
                          </div>
          
                          <div class="tab-pane fade pt-3" id="profile-change-name">
                            <!-- change-name Form -->
                            <form>
      
          
                              <div class="row mb-3">
                                <label for="newName" class="col-md-4 col-lg-3 col-form-label">新名稱</label>
                                <div class="col-md-8 col-lg-9">
                                  <input name="newname" type="text" class="form-control" id="newName" required/>
                                  <div class="invalid-feedback">
                                    請輸入你的新名稱!
                                  </div>
                                </div>
                              </div>
                             
                              <div class="text-center">
                                <input type="button" value="更新" class="btn btn-success" id="submitname">
                              </div>
                            </form><!-- End change-name Form -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
    
    <!-- End #main -->
    <script type="text/javascript">
      // 取得網址參數
      var url_string = window.location.href;
      var url = new URL(url_string);
      var id = url.searchParams.get("id");
      var sql_num = 0;

      function updateMember(id) {
          var name = $('#newName').val();
          var phone = $('#newphone').val();
          var email = $('#newemail').val();
          var password = $('#currentPassword').val();

          var password_rule = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;

          if(!password_rule.test(password)) {
              alert("密碼格式不符，長度至少8，且至少包含一個數字和英文字母！");
          }
          else {
              // 將資料組成JSON格式
              var data_object = {
                  "id": id,
                  "name": name,
                  "email": email,
                  "phone": phone,
                  "password": password
              };

              // 將JSON格式轉換成字串
              var data_string = JSON.stringify(data_object);

              // 發出POST的PUT請求
              $.ajax({
                      type: "PUT",
                      url: "api/samember.do",
                      data: data_string,
                      crossDomain: true,
                      cache: false,
                      dataType: 'json',
                      timeout: 5000,
                      success: function (response) {
                          $('#flashMessage').html(response.message);
                          $('#flashMessage').show();
                          if(response.status == 200){
                              //updateSQLTable(response.response);
                              getMember();
                          }
                      },
                      error: function () {
                          alert("無法連線到伺服器！");
                      }
              });
          }
      }

      // 更新SQL指令歷史表格
      function updateSQLTable(data) {
          var time = (data.time / 1000000).toFixed(2);
          var table_html = "";
          
          sql_num += 1

          table_html += '<tr>';
          table_html += '<td>' + sql_num + '</td>';
          table_html += '<td>' + data.sql + '</td>';
          table_html += '<td style="text-align: right">' + '0' + '</td>';
          table_html += '<td style="text-align: right">' + data.row + '</td>';
          table_html += '<td style="text-align: right">' + data.row + '</td>';
          table_html += '<td style="text-align: right">' + time + '</td>';
          table_html += '</tr>';
          $("#sql_log > tbody").append(table_html);
          $("#sql_summary").html("(default) " + data.row + " queries took " + time + " ms");
      }

      function getMember() {
          $.ajax({
              type: "GET",
              url: "api/samember.do",
              crossDomain: true,
              data: "id=" + id,
              cache: false,
              dataType: 'json',
              timeout: 5000,
              success: function (response) {
                  if(response.status == 200){
                    //updateSQLTable(response.response);
                    document.getElementById('newName').value = response['response']['data'][0]['name'];
                    document.getElementById('disable_name').innerHTML = response['response']['data'][0]['name'];
                    document.getElementById('newemail').value = response['response']['data'][0]['email'];
                    document.getElementById('currentPassword').value = response['response']['data'][0]['password'];
                    document.getElementById('newphone').value = response['response']['data'][0]['phone'];
                    document.getElementById('disable_phone').innerHTML = response['response']['data'][0]['phone'];
                  }
                  console.log(response);
              },
              error: function () {
                  alert("無法連線到伺服器！");
              }
          });
      }

      $('#submitphone').click(function() {
          updateMember(id);
      });

      $('#submitname').click(function() {
          updateMember(id);
      });

      $('#submitpassword').click(function() {
          updateMember(id);
      });

      $(document).ready(function() {
        // 發出GET的AJAX請求取得原本該會員的資料
          $("#sql_log > tbody").empty();
          getMember();
      });
    </script>
    <!-- Vendor JS Files -->
    <script src="assetsA/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="assetsA/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assetsA/vendor/chart.js/chart.min.js"></script>
    <script src="assetsA/vendor/echarts/echarts.min.js"></script>
    <script src="assetsA/vendor/quill/quill.min.js"></script>
    <script src="assetsA/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="assetsA/vendor/tinymce/tinymce.min.js"></script>
    <script src="assetsA/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="assetsA/js/main.js"></script>

    <script>
      // console.log("helllo");
      let memberId = new URL(location.href).searchParams.get("id");
      console.log("memberId", memberId);
      if(memberId){
        console.log("123")
        document.getElementById("link1").href += `?id=${memberId}` 
        document.getElementById("link2").href += `?id=${memberId}` 
        document.getElementById("link3").href += `?id=${memberId}` 
        document.getElementById("link4").href += `?id=${memberId}` 
        document.getElementById("link5").href += `?id=${memberId}` 
        document.getElementById("link6").href += `?id=${memberId}` 
        document.getElementById("link8").href = `memberProfile.html?id=${memberId}`
        document.getElementById("link7").innerHTML = "登出" 
        document.getElementById("link8").innerHTML = "會員修改"
        document.getElementById("link9").innerHTML = "我的車票"
        document.getElementById("link9").href += `?id=${memberId}` 
      }
    </script>
  </body>
</html>